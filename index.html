<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nutrition Chat (n8n)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:0; background:#0b0d10; color:#e8eef7; }
    .wrap { max-width: 820px; margin: 0 auto; padding: 20px; }
    .card { background:#12161c; border:1px solid #1f2630; border-radius:14px; overflow:hidden; }
    .top { padding:14px 16px; border-bottom:1px solid #1f2630; display:flex; gap:10px; align-items:center; }
    .dot { width:10px; height:10px; border-radius:50%; background:#3ddc97; box-shadow:0 0 0 3px rgba(61,220,151,.15); }
    .title { font-weight:600; }
    .sub { opacity:.75; font-size:13px; margin-left:auto; }
    .msgs { padding:16px; height: 65vh; overflow:auto; display:flex; flex-direction:column; gap:10px; }
    .row { display:flex; }
    .me { justify-content:flex-end; }
    .bot { justify-content:flex-start; }
    .bubble {
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 14px;
      line-height: 1.35;
      white-space: pre-wrap;
      border: 1px solid #1f2630;
    }
    .me .bubble { background:#1a2430; }
    .bot .bubble { background:#111a22; }
    .meta { opacity:.65; font-size:12px; margin-top:4px; }
    .bar { padding:12px; border-top:1px solid #1f2630; display:flex; gap:10px; }
    input, textarea {
      width:100%; padding:10px 12px; border-radius:12px;
      border:1px solid #1f2630; background:#0f1318; color:#e8eef7;
      outline:none;
    }
    button {
      padding:10px 14px; border-radius:12px; border:1px solid #2a3442;
      background:#16202b; color:#e8eef7; cursor:pointer; white-space:nowrap;
    }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .settings { display:grid; grid-template-columns: 1fr 1fr; gap:10px; padding:12px; border-bottom:1px solid #1f2630; }
    .settings label { font-size:12px; opacity:.8; display:block; margin-bottom:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="dot"></div>
        <div class="title">Nutrition Chat</div>
        <div class="sub">n8n webhook</div>
      </div>

      <div class="settings">
        <div>
          <label>conversation_id</label>
          <input id="conv" value="conv_001" />
        </div>
        <div>
          <label>user_id</label>
          <input id="uid" value="anon_123" />
        </div>
      </div>

      <div id="msgs" class="msgs"></div>

      <div class="bar">
        <input id="msg" placeholder="Type a message..." />
        <button id="send">Send</button>
      </div>
    </div>
  </div>

  <script>
    const WEBHOOK_URL = "https://diego-marino.app.n8n.cloud/webhook/chat";

    const elMsgs = document.getElementById("msgs");
    const elMsg = document.getElementById("msg");
    const elSend = document.getElementById("send");
    const elConv = document.getElementById("conv");
    const elUid = document.getElementById("uid");

    function addBubble(role, text) {
      const row = document.createElement("div");
      row.className = "row " + (role === "me" ? "me" : "bot");

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;

      row.appendChild(bubble);
      elMsgs.appendChild(row);
      elMsgs.scrollTop = elMsgs.scrollHeight;
      return bubble;
    }

    async function send() {
      const message = elMsg.value.trim();
      if (!message) return;

      elMsg.value = "";
      addBubble("me", message);

      elSend.disabled = true;
      const pending = addBubble("bot", "…");

      try {
        const payload = {
          conversation_id: elConv.value.trim() || "conv_001",
          user_id: elUid.value.trim() || "anon_123",
          message
        };

        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const txt = await res.text();
          throw new Error(`HTTP ${res.status}: ${txt}`);
        }

        const data = await res.json();

        // Expecting { "answer": "..." } — fallback if your webhook returns plain text
        const answer = (data && (data.answer || data.output || data.text)) ?? JSON.stringify(data);
        pending.textContent = answer;

      } catch (err) {
        pending.textContent = "Error: " + (err.message || err);
      } finally {
        elSend.disabled = false;
        elMsg.focus();
      }
    }

    elSend.addEventListener("click", send);
    elMsg.addEventListener("keydown", (e) => {
      if (e.key === "Enter") send();
    });

    // Seed message
    addBubble("bot", "Hi! Ask me something nutrition-related.");
  </script>
</body>
</html>



